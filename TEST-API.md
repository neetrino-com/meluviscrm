# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤—Å–µ—Ö API endpoints.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   npm run dev
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env.local`:**
   ```env
   API_TOKEN="your-api-token-here"
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:**
   ```bash
   npm run test:api
   ```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ 5 endpoints –∏ –ø–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ cURL

#### 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–π–æ–Ω–æ–≤

```bash
curl -X GET http://localhost:3000/api/districts \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø–∏—Å–æ–∫ —Ä–∞–π–æ–Ω–æ–≤ —Å `id` –∏ `slug`

---

#### 2. –ü–æ–ª—É—á–∏—Ç—å –∑–¥–∞–Ω–∏—è –ø–æ District ID

–ó–∞–º–µ–Ω–∏—Ç–µ `1` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID —Ä–∞–π–æ–Ω–∞ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X GET http://localhost:3000/api/districts/1/buildings \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø–∏—Å–æ–∫ –∑–¥–∞–Ω–∏–π —Å `id`, `slug`, `district_id`, `district_slug`

---

#### 3. –ü–æ–ª—É—á–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ Building ID

–ó–∞–º–µ–Ω–∏—Ç–µ `10` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∑–¥–∞–Ω–∏—è –∏–∑ –≤—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X GET "http://localhost:3000/api/buildings/10/apartments?status=available" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—ä–µ–∫—Ç —Å `items` (–º–∞—Å—Å–∏–≤ –∫–≤–∞—Ä—Ç–∏—Ä) –∏ `pagination`

---

#### 4. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã

–ó–∞–º–µ–Ω–∏—Ç–µ `501` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∫–≤–∞—Ä—Ç–∏—Ä—ã –∏–∑ —Ç—Ä–µ—Ç—å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X GET http://localhost:3000/api/external/apartments/501 \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–≤–∞—Ä—Ç–∏—Ä–µ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏

---

#### 5. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã

```bash
curl -X PUT http://localhost:3000/api/apartments/501/status \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"status": "reserved"}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `{"id": 501, "status": "reserved", "updated_at": "..."}`

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫

### –¢–µ—Å—Ç –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 401)

```bash
curl -X GET http://localhost:3000/api/districts
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `{"error": "Unauthorized"}` —Å –∫–æ–¥–æ–º 401

---

### –¢–µ—Å—Ç —Å –Ω–µ–≤–µ—Ä–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 401)

```bash
curl -X GET http://localhost:3000/api/districts \
  -H "Authorization: Bearer wrong-token"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `{"error": "Unauthorized"}` —Å –∫–æ–¥–æ–º 401

---

### –¢–µ—Å—Ç —Å –Ω–µ–≤–µ—Ä–Ω—ã–º ID (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 404)

```bash
curl -X GET http://localhost:3000/api/districts/99999/buildings \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `{"error": "District not found"}` —Å –∫–æ–¥–æ–º 404

---

## üìã –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`npm run dev`)
- [ ] API_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env.local`
- [ ] –¢–µ—Å—Ç 1: GET /api/districts - —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç 2: GET /api/districts/{id}/buildings - —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç 3: GET /api/buildings/{id}/apartments - —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç 4: GET /api/external/apartments/{id} - —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç 5: PUT /api/apartments/{id}/status - —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401
- [ ] –¢–µ—Å—Ç —Å –Ω–µ–≤–µ—Ä–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401
- [ ] –¢–µ—Å—Ç —Å –Ω–µ–≤–µ—Ä–Ω—ã–º ID - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "API_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env.local` –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞:
```env
API_TOKEN="your-token-here"
```

---

### –û—à–∏–±–∫–∞: "Failed to fetch" –∏–ª–∏ "ECONNREFUSED"

**–†–µ—à–µ–Ω–∏–µ:** 
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `npm run dev`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `http://localhost:3000`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 3000 –Ω–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º

---

### –û—à–∏–±–∫–∞: "District not found" –∏–ª–∏ "Building not found"

**–†–µ—à–µ–Ω–∏–µ:** 
1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: `npm run db:seed-data`
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

### –û—à–∏–±–∫–∞: "Unauthorized" –¥–∞–∂–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –≤ `.env.local` —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env.local`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `Bearer ` –ø–µ—Ä–µ–¥ —Ç–æ–∫–µ–Ω–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ

---

## üìä –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

```
üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...
üìç –ë–∞–∑–æ–≤—ã–π URL: http://localhost:3000
üîë API Token: ***2345

üß™ –¢–µ—Å—Ç–∏—Ä—É—é: 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–π–æ–Ω–æ–≤
   GET http://localhost:3000/api/districts
   ‚úÖ –£—Å–ø–µ—à–Ω–æ (200)
   üìä –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 2

üß™ –¢–µ—Å—Ç–∏—Ä—É—é: 2. –ü–æ–ª—É—á–∏—Ç—å –∑–¥–∞–Ω–∏—è –ø–æ District ID
   GET http://localhost:3000/api/districts/1/buildings
   ‚úÖ –£—Å–ø–µ—à–Ω–æ (200)
   üìä –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 3

...

============================================================
üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
============================================================
‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: 6
‚ùå –ü—Ä–æ–≤–∞–ª–∏–≤—à–∏—Ö—Å—è —Ç–µ—Å—Ç–æ–≤: 0
üìà –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 6
============================================================
```

---

## üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging/production

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–∑–º–µ–Ω–∏—Ç–µ –±–∞–∑–æ–≤—ã–π URL:

```bash
# –í —Å–∫—Ä–∏–ø—Ç–µ test-api.ts –∏–∑–º–µ–Ω–∏—Ç–µ:
const API_BASE_URL = 'https://meluvis-crm-staging.vercel.app';
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
NEXTAUTH_URL=https://meluvis-crm-staging.vercel.app npm run test:api
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-19
