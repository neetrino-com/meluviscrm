# üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ MD5 –¥–ª—è —Ñ–∞–π–ª–æ–≤

## üîç –ß—Ç–æ —Ç–∞–∫–æ–µ MD5?

**MD5 (Message Digest 5)** ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é "–æ—Ç–ø–µ—á–∞—Ç–æ–∫" (—Ö–µ—à) –¥–ª—è –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–î–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞** ‚Üí –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π MD5**
2. **–î–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** ‚Üí –ø–æ–ª—É—á–∞—é—Ç—Å—è **—Ä–∞–∑–Ω—ã–µ MD5** (—Å –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é)
3. **MD5 ‚Äî —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∏–∑ 32 —Å–∏–º–≤–æ–ª–æ–≤**, –Ω–∞–ø—Ä–∏–º–µ—Ä: `5d41402abc4b2a76b9719d911017c592`

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
- ‚úÖ **–ò–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫** ‚Äî –µ—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ —É–∂–µ –µ—Å—Ç—å —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –∂–µ MD5, –æ–Ω –Ω–µ –±—É–¥–µ—Ç –µ–≥–æ —Å–∫–∞—á–∏–≤–∞—Ç—å
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä** ‚Äî –∫–ª–∏–µ–Ω—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ/–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```
–ö–ª–∏–µ–Ω—Ç: "–£ –º–µ–Ω—è –µ—Å—Ç—å —Ñ–∞–π–ª —Å MD5 = abc123..."
–°–µ—Ä–≤–µ—Ä: "–£ –º–µ–Ω—è —Ñ–∞–π–ª —Å MD5 = xyz789..."
–ö–ª–∏–µ–Ω—Ç: "MD5 —Ä–∞–∑–Ω—ã–µ ‚Üí –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª"

–ö–ª–∏–µ–Ω—Ç: "–£ –º–µ–Ω—è –µ—Å—Ç—å —Ñ–∞–π–ª —Å MD5 = abc123..."
–°–µ—Ä–≤–µ—Ä: "–£ –º–µ–Ω—è —Ñ–∞–π–ª —Å MD5 = abc123..."
–ö–ª–∏–µ–Ω—Ç: "MD5 –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ ‚Üí —Ñ–∞–π–ª —É–∂–µ –µ—Å—Ç—å, —Å–∫–∞—á–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!"
```

---

## üéØ –¶–µ–ª—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–æ—Ä–æ–Ω–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ API, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å —É –Ω–∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ª–∏—à–Ω—é—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å MD5 —Ö–µ—à–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç –º–æ–≥ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —É –Ω–µ–≥–æ —É–∂–µ –µ—Å—Ç—å, –∏ —Å–∫–∞—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç.

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
```
–ö–ª–∏–µ–Ω—Ç ‚Üí API ‚Üí –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ ‚Üí –°–∫–∞—á–∏–≤–∞–µ—Ç –í–°–ï —Ñ–∞–π–ª—ã
```

### –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```
–ö–ª–∏–µ–Ω—Ç ‚Üí API ‚Üí –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å MD5 ‚Üí 
  ‚Üí –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç MD5 —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ ‚Üí 
  ‚Üí –°–∫–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã —Å –Ω–æ–≤—ã–º–∏ MD5
```

---

## ‚úÖ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `md5Hash` –≤ —Ç–∞–±–ª–∏—Ü—É `apartment_attachments` (—Ç–∏–ø: `String`, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Prisma
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `prisma/schema.prisma` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `md5Hash String? @map("md5_hash")`
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

---

### –≠—Ç–∞–ø 2: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ MD5 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è MD5 (–Ω–∞–ø—Ä–∏–º–µ—Ä, `crypto` –∏–∑ Node.js)
- [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `POST /api/apartments/[id]/attachments`:
  - [ ] –í—ã—á–∏—Å–ª—è—Ç—å MD5 —Ö–µ—à —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –≤ Blob
  - [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å MD5 –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–µ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `attachmentService.create()` –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è MD5

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/api/apartments/[id]/attachments/route.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ MD5
- `services/attachment.service.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `md5Hash`

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
```typescript
import crypto from 'crypto';

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ MD5
const fileBuffer = await file.arrayBuffer();
const hash = crypto.createHash('md5').update(Buffer.from(fileBuffer)).digest('hex');
```

---

### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ (–º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è MD5 –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω:
  - [ ] –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –ë–î
  - [ ] –°–∫–∞—á–∞—Ç—å –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –∏–∑ Vercel Blob
  - [ ] –í—ã—á–∏—Å–ª–∏—Ç—å MD5
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è MD5 –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `scripts/calculate-md5-for-existing-files.ts` ‚Äî —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è MD5 –≤ –ë–î.

---

### –≠—Ç–∞–ø 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ MD5 –≤ API –æ—Ç–≤–µ—Ç—ã
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `GET /api/apartments/[id]/attachments` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `md5Hash` –≤ –æ—Ç–≤–µ—Ç
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `GET /api/external/apartments/[id]` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `md5Hash` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ attachment
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ MD5 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö API endpoints, –≥–¥–µ –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–∞—Ö

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `app/api/apartments/[id]/attachments/route.ts` ‚Äî GET –º–µ—Ç–æ–¥
- `app/api/external/apartments/[id]/route.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å md5Hash –≤ attachments

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ API:**
```json
{
  "attachments": [
    {
      "id": 1,
      "fileUrl": "https://...",
      "fileName": "floorplan.pdf",
      "fileSize": 12345,
      "fileType": "FLOORPLAN",
      "md5Hash": "5d41402abc4b2a76b9719d911017c592",
      "createdAt": "2026-01-26T10:00:00Z"
    }
  ]
}
```

---

### –≠—Ç–∞–ø 5: –ù–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –°–æ–∑–¥–∞—Ç—å endpoint `GET /api/external/files/check`:
  - [ ] –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ MD5 —Ö–µ—à–µ–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —É –∫–ª–∏–µ–Ω—Ç–∞ (MD5 –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç)
- [ ] –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∫–ª–∏–µ–Ω—Ç—É –æ–¥–Ω–æ–π –∑–∞–ø—Ä–æ—Å–æ–º —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `app/api/external/files/check/route.ts` ‚Äî –Ω–æ–≤—ã–π endpoint

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
// –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
POST /api/external/files/check
{
  "md5Hashes": ["abc123", "xyz789", "def456"]
}

// –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:
{
  "filesToDownload": [
    {
      "id": 1,
      "fileUrl": "https://...",
      "md5Hash": "xyz789"
    }
  ],
  "filesAlreadyHave": ["abc123", "def456"]
}
```

---

### –≠—Ç–∞–ø 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –∫–æ–º–∞–Ω–¥—ã
**–°—Ä–æ–∫:** 0.5 –¥–Ω—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `API-SPECIFICATION.md`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—è `md5Hash`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MD5 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–∫–∞–∫ –≤—ã—á–∏—Å–ª—è—Ç—å MD5 –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å)

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `Documents/API-SPECIFICATION.md`

---

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### –ó–∞–¥–∞—á–∏:
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ MD5 –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ MD5 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –ø–æ–ª—É—á–∞—é—Ç MD5
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ (PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

---

## üìÖ –û–±—â–∏–π timeline

| –≠—Ç–∞–ø | –î–Ω–∏ | –°—Ç–∞—Ç—É—Å |
|------|-----|--------|
| 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î | 1 | ‚è≥ |
| 2. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ MD5 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ | 1 | ‚è≥ |
| 3. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ | 1 | ‚è≥ |
| 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ MD5 –≤ API | 1 | ‚è≥ |
| 5. –ù–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ | 1 | ‚è≥ |
| 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 0.5 | ‚è≥ |
| 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 1 | ‚è≥ |
| **–ò–¢–û–ì–û** | **6.5 –¥–Ω–µ–π** | |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- **Node.js `crypto`** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è MD5 (–Ω–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:
```typescript
// Prisma Schema
model ApartmentAttachment {
  id          Int      @id @default(autoincrement())
  apartmentId Int      @map("apartment_id")
  fileType    FileType @map("file_type")
  fileUrl     String   @map("file_url") @db.Text
  fileName    String?  @map("file_name")
  fileSize    Int?     @map("file_size")
  md5Hash     String?  @map("md5_hash")  // –ù–û–í–û–ï –ü–û–õ–ï
  createdAt   DateTime @default(now()) @map("created_at")
  
  apartment Apartment @relation(...)
  
  @@index([md5Hash])  // –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ MD5
  @@map("apartment_attachments")
}
```

### –ü—Ä–∏–º–µ—Ä –≤—ã—á–∏—Å–ª–µ–Ω–∏—è MD5:
```typescript
import crypto from 'crypto';

async function calculateMD5(file: File): Promise<string> {
  const arrayBuffer = await file.arrayBuffer();
  const buffer = Buffer.from(arrayBuffer);
  const hash = crypto.createHash('md5').update(buffer).digest('hex');
  return hash;
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ MD5 –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫

### 2. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å MD5:
- MD5 –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç 100% —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã –∫–æ–ª–ª–∏–∑–∏–∏)
- –î–ª—è —Ñ–∞–π–ª–æ–≤ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏ –∫—Ä–∞–π–Ω–µ –º–∞–ª–∞
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª—å—à–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SHA-256 (–Ω–æ MD5 –ø—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ)

### 3. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- –ü–æ–ª–µ `md5Hash` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º (`String?`)
- –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –±–µ–∑ MD5 –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Ö –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 4. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î
- –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤ —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∏–ª–∏ —á–µ—Ä–µ–∑ cron job

---

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

### –ö–∞–∫ —Å—Ç–æ—Ä–æ–Ω–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MD5:

```typescript
// 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å MD5
const response = await fetch('/api/external/apartments/123', {
  headers: { 'Authorization': 'Bearer TOKEN' }
});
const apartment = await response.json();

// 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –æ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
for (const attachment of apartment.attachments) {
  // –í—ã—á–∏—Å–ª–∏—Ç—å MD5 –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å)
  const localMD5 = await calculateLocalFileMD5(attachment.fileName);
  
  // –°—Ä–∞–≤–Ω–∏—Ç—å MD5
  if (localMD5 !== attachment.md5Hash) {
    // –§–∞–π–ª –Ω–æ–≤—ã–π –∏–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Üí —Å–∫–∞—á–∞—Ç—å
    await downloadFile(attachment.fileUrl, attachment.fileName);
  } else {
    // –§–∞–π–ª —É–∂–µ –µ—Å—Ç—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
    console.log(`File ${attachment.fileName} already exists, skipping...`);
  }
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π, –∫–æ–≥–¥–∞:

- [ ] –ü–æ–ª–µ `md5Hash` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è MD5
- [ ] –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç MD5 (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)
- [ ] API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `md5Hash` –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- [ ] –°—Ç–æ—Ä–æ–Ω–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MD5 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-26
